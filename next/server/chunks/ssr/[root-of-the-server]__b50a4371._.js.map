{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 15, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/src/app/driver-hub/profile/actions.ts"],"sourcesContent":["\n'use server';\n\nimport type { Job } from '@/lib/truckershub-types';\nimport type { Application } from '@/lib/applications';\nimport fs from 'fs/promises';\nimport path from 'path';\nimport { unstable_cache as cache } from 'next/cache';\n\n\nconst applicationsFilePath = path.join(process.cwd(), 'src', 'lib', 'applications.json');\nconst VTC_ID = '1600';\n\n\nconst readJsonFile = cache(async <T>(filePath: string): Promise<T> => {\n    try {\n        const fileContent = await fs.readFile(filePath, 'utf-8');\n        return JSON.parse(fileContent);\n    } catch (error) {\n        if ((error as NodeJS.ErrnoException).code === 'ENOENT') {\n           return { applications: [] } as any;\n        }\n        throw error;\n    }\n}, ['json-files-data'], { revalidate: 10 });\n\n\ntype UserApiResponse = {\n    username: string;\n    steamID: string;\n    avatar: string;\n    country: string;\n    role: {\n        name: string;\n    };\n    truckersmp_id: number;\n    id: number;\n    registered: string;\n};\n\ntype JobsApiResponse = {\n    status: boolean;\n    response: Job[] | {};\n};\n\ntype GameStats = {\n    total_km: number;\n    total_jobs: number;\n    longest_job: number;\n};\n\ntype StatsApiResponse = {\n    level: number;\n    xp: { total: number };\n    income: { total: number };\n    total_jobs: number;\n    total_distance: number;\n    fuel_burned: { total: number };\n    weight: { total: number };\n    ets: GameStats;\n    ats: GameStats;\n};\n\nexport type UserProfile = Application & {\n    license_number: string;\n    division: string | null;\n    timezone: string;\n    jobs: Job[];\n    stats: StatsApiResponse | null;\n    avatar: string;\n    total_km: number;\n    total_jobs: number;\n    longest_job: number;\n    registered: string;\n    role: string;\n    monthly_xp: number;\n    monthly_income: number;\n    monthly_weight: number;\n    monthly_fuel: number;\n    truckersmpId: number | null;\n};\n\nasync function fetchFromTruckersHub<T>(endpoint: string, params?: URLSearchParams): Promise<any | null> {\n    const apiKey = process.env.TRUCKERSHUB_API_KEY;\n    if (!apiKey) {\n        console.error(\"TRUCKERSHUB_API_KEY is not set.\");\n        return null;\n    }\n\n    try {\n        const url = new URL(`https://api.truckershub.in/v1/${endpoint}`);\n        if (params) {\n            params.forEach((value, key) => {\n                url.searchParams.append(key, value);\n            });\n        }\n        \n        const res = await fetch(url.toString(), {\n             headers: {\n                'Authorization': `Bearer ${apiKey}`,\n                'Content-Type': 'application/json',\n                'User-Agent': 'TamilPasangaVTC/1.0',\n            },\n            next: { revalidate: 300 } // Revalidate every 5 minutes\n        });\n\n\n        if (!res.ok) {\n            console.error(`Failed to fetch from TruckersHub (${endpoint}):`, res.status, await res.text());\n            return null;\n        }\n\n        const data: any = await res.json();\n        \n        if (data) {\n             if (endpoint.startsWith('vtc/')) {\n                if (data.vtc) {\n                    if (endpoint.endsWith('/jobs')) return data.vtc.jobs;\n                    if (endpoint.endsWith('/drivers')) return data.vtc.drivers;\n                    if (endpoint.endsWith('/deliveries/live')) return data.vtc.deliveries;\n                    if (endpoint.endsWith('/drivers/live')) return data.vtc.drivers_live;\n                    return data.vtc;\n                }\n             }\n            if (data.response) return data.response;\n            if (data.jobs) return data.jobs;\n            if (Array.isArray(data.drivers)) return data.drivers;\n            if (data.skills) return { skills: data.skills };\n            if (data.routes) return data.routes;\n            if(data.statistics) return data.statistics;\n            if (Array.isArray(data)) return data;\n            if (data.status === false) {\n                 if (Object.keys(data).length > 2 || (endpoint !== 'live/delivery' && !endpoint.includes('vtc'))) { \n                    console.warn(`TruckersHub API returned status false for ${endpoint}:`, JSON.stringify(data));\n                 }\n                 return null;\n            }\n            return data;\n        }\n        \n        return null;\n\n    } catch (error) {\n        console.error(`Error fetching from TruckersHub (${endpoint}):`, error);\n        return null;\n    }\n}\n\n\nasync function getTMPVTCDetails(truckersmpId: number | null) {\n    if (!truckersmpId) return null;\n    try {\n        const res = await fetch(`${process.env.APP_URL}/api/truckersmp?endpoint=player/${truckersmpId}`);\n        if (!res.ok) return null;\n        const data = await res.json();\n        return data.response?.vtc;\n    } catch (error) {\n        console.error(\"Failed to fetch from TruckersMP:\", error);\n        return null;\n    }\n}\n\n\nexport async function getProfileData(email: string): Promise<UserProfile | null> {\n    const applicationsData = await readJsonFile<{ applications: Application[] }>(applicationsFilePath);\n    const userApplication = applicationsData.applications.find(app => app.email === email && app.status === 'Accepted');\n\n    if (userApplication) {\n        const [jobsData, statsData, driverData] = await Promise.all([\n            fetchFromTruckersHub<JobsApiResponse['response']>(`drivers/${userApplication.steamId}/jobs`),\n            fetchFromTruckersHub<StatsApiResponse>(`statistics/${userApplication.steamId}`),\n            fetchFromTruckersHub<UserApiResponse>(`drivers/${userApplication.steamId}`),\n        ]);\n        \n        const driver = driverData;\n        const truckersmpId = driver?.truckersmp_id || null;\n\n        const [tmpVtcData] = await Promise.all([\n             getTMPVTCDetails(truckersmpId),\n        ]);\n\n\n        const jobs = (jobsData && Array.isArray(jobsData)) ? jobsData : [];\n        const stats = statsData || null;\n\n        const totalKm = stats?.total_distance ?? 0;\n        const totalJobs = stats?.total_jobs ?? 0;\n\n        return {\n            ...userApplication,\n            license_number: `TP${userApplication.id.substring(4, 10)}`,\n            division: 'Alpha',\n            timezone: 'Asia/Kolkata', // Placeholder\n            jobs,\n            stats,\n            avatar: userApplication.avatar || driver?.avatar || \"https://static.truckersmp.com/avatars/5635477.1754020942.png\",\n            total_km: totalKm,\n            total_jobs: totalJobs,\n            longest_job: 0, // This data is not in the new structure\n            registered: driver?.registered || userApplication.submittedAt,\n            role: tmpVtcData?.role || driver?.role?.name || 'Driver',\n            monthly_xp: stats?.xp?.total ?? 0,\n            monthly_income: stats?.income?.total ?? 0,\n            monthly_weight: stats?.weight?.total ?? 0,\n            monthly_fuel: stats?.fuel_burned?.total ?? 0,\n            truckersmpId: truckersmpId,\n        };\n    } else {\n        console.error(`No accepted application found for email:`, email);\n        return null;\n    }\n}\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 174, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/.next-internal/server/app/driver-hub/profile/page/actions.js%20%28server%20actions%20loader%29"],"sourcesContent":["export {getProfileData as '40fd4297d0ee03e0f048c25cec0c7fdd31c36392c2'} from 'ACTIONS_MODULE0'\n"],"names":[],"mappings":";AAAA","debugId":null}},
    {"offset": {"line": 232, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/src/app/driver-hub/profile/page.tsx/proxy.mjs"],"sourcesContent":["import { registerClientReference } from \"react-server-dom-turbopack/server.edge\";\nexport default registerClientReference(\n    function() { throw new Error(\"Attempted to call the default export of [project]/src/app/driver-hub/profile/page.tsx <module evaluation> from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/src/app/driver-hub/profile/page.tsx <module evaluation>\",\n    \"default\",\n);\n"],"names":[],"mappings":";;;AAAA;;uCACe,CAAA,GAAA,qPAAA,CAAA,0BAAuB,AAAD,EACjC;IAAa,MAAM,IAAI,MAAM;AAAuS,GACpU,qEACA","debugId":null}},
    {"offset": {"line": 246, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/src/app/driver-hub/profile/page.tsx/proxy.mjs"],"sourcesContent":["import { registerClientReference } from \"react-server-dom-turbopack/server.edge\";\nexport default registerClientReference(\n    function() { throw new Error(\"Attempted to call the default export of [project]/src/app/driver-hub/profile/page.tsx from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/src/app/driver-hub/profile/page.tsx\",\n    \"default\",\n);\n"],"names":[],"mappings":";;;AAAA;;uCACe,CAAA,GAAA,qPAAA,CAAA,0BAAuB,AAAD,EACjC;IAAa,MAAM,IAAI,MAAM;AAAmR,GAChT,iDACA","debugId":null}},
    {"offset": {"line": 260, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}}]
}